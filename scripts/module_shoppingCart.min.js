Site.ShoppingCart=function(t){this.moduleId=t,this.module=Fai.top.$("#module"+t),this.shoppingCart=this.module.find(".shoppingCart"+t),this.cartButton=this.module.find(".cartButton"),this.cartListWrap=Fai.top.$(".J_cartListWrap"+t),this.cartList=this.cartListWrap.find(".dropCartList"),this.colorCode=this.module.find(".shoppingCartBox").attr("cartColor")},function(t,s,i){var a=Site.ShoppingCart.prototype,o="";function r(t,s,i){e();var a=t.isValid,r=t.inValidType,n=[];n.push("<li class='sCart-sigle "+(a?"":"invalidItem")+"' itemId='"+t.id+"'>"),n.push("<div class='sC-img'>"),n.push("<img width='60' height='60' alt="+Fai.encodeHtml(t.name)+" src="+t.picPath+">"),n.push("</div>"),a||("notAdded"==r||"delete"==r?n.push("<div class='notAdded'><span class='notAddedTip' title='"+LS.notAdded+"'>"+LS.notAdded+"</span><i class='visible'></i></div>"):"outOfStock"==r&&n.push("<div class='notAdded'><span class='notAddedTip' style='font-size: 12px;line-height: normal;' title='"+LS.invalid+"'>"+LS.invalid+"</span><i class='visible'></i></div>")),n.push("<div class='sC-proLeft' style=' width: 100px'>"),n.push("<span class='sC-pdName' style='width:80px;' title='"+Fai.encodeHtml(t.name)+"'>"+Fai.encodeHtml(t.name)+"</span>"),n.push("<span class='sC-pdOption' style='width:135px;' title='"+Fai.encodeHtml(t.optionType)+"'>"+Fai.encodeHtml(t.optionType)+"</span>"),n.push("</div>");var p=t.amount;return p>9999&&(p=(p+"").substring(0,3)+"..."),n.push("<div class='sC-detail'>"),n.push("<a class='sC-delItem' style='font-size:12px;' hidefocus='true' href='javascript:;' itemId='"+t.id+"'  tmpProductId='"+t.id+"'>"+LS.memberMallCartDel+"</a>"),n.push("<span class='sC-amount' style='position:relative;float:right;'>x"+p+"</span>"),n.push("<span class='sC-price' style='float:right;margin-top:-20px;margin-right:30px;color:"+o+";'>"+i.toString()+t.price.toFixed(2)+"</span>"),n.push("</div>"),n.push("</li>"),n.join("")}function e(){LS||Fai.ing("多语言文件未引入",!1)}function n(t){return t.indexOf("#")<0&&(t.indexOf("rgba")>=0||t.indexOf("RGBA")>=0)}function p(t){if(n(t)){if(t.indexOf("transparent")>=0)return"rgb(255,255,255)";var s=t.split("(")[1].split(")")[0].split(",");return"rgb("+s[0]+","+s[1]+","+s[2]+")"}}a.TITLE="最新加入的商品",a.init=function(){this.initBind(),Fai.top.$("#g_main").append(this.cartListWrap),this.refreshData(),function(t,s,i){if(!Fai.isIE6()&&!Fai.isIE7()&&!Fai.isIE8())return;if(!n(t))return;var a=p(t),o=s.find(".shoppingCartBox").hasClass("shoppingCartRange1");s.find(".shoppingCartBox").attr("cartColor",a),o&&s.find(".cartButton").css("background-color",a);o||s.find(".cartLeft").css("background-color",a);s.find(".shoppingAmount").css("background-color",a),s.find(".shoppingAmount2").css("border-bottom-color",a),o&&i.css("border","2px solid "+a)}(this.colorCode,this.module,this.cartList)},a.initBind=function(){var t,s,i=!1,a=!1,o=this,r=this.cartButton,e=this.cartList;13!=Fai.top._colId&&14!=Fai.top._colId&&(r.off("click.sC").on("click.sC",function(){window.open("mcart.jsp","_blank")}),r.off("mouseenter.sC").on("mouseenter.sC",function(){if(a&&(clearTimeout(s),a=!1),e.is(":hidden")){r.addClass("cartButton_hover"),e.css("opacity",0),e.css("height",""),e.addClass("dropCartList_hover");var t=e.height();e.css("height",0),p=o.cartListWrap,c=o.moduleId,u=Fai.top.$("#module"+c).parent().hasClass("J_bottomFloatLayerContent"),f="",d=Site.getModuleGMainRect(c),l=d.right,h=d.top,f=u?9030:f,p.css({left:l-p.find(".dropCartList").outerWidth(),top:h,"z-index":f}),e.stop(!0,!1).animate({height:t,opacity:1},200,function(){e.css("height",""),r.addClass("cartButton_hover")}),(n=(i=o).cartList||i.module.find(".dropCartList")).offset().left<0&&n.addClass("showCartRight"),o.refreshData(o.moduleId)}var i,n,p,c,d,l,h,u,f}),r.off("mouseleave.sC").on("mouseleave.sC",function(){i=!0,t=setTimeout(function(){r.removeClass("cartButton_hover"),e.stop(!0,!0).animate({height:0,opacity:0},100,function(){e.removeClass("showCartRight dropCartList_hover"),r.removeClass("cartButton_hover"),e.css("height","")})},50)}),e.off("mouseenter.sC").on("mouseenter.sC",function(){i&&(clearTimeout(t),i=!1)}),e.off("mouseleave.sC").on("mouseleave.sC",function(){a=!0,s=setTimeout(function(){r.removeClass("cartButton_hover"),e.stop(!0,!0).animate({height:0,opacity:0},100,function(){e.removeClass("showCartRight dropCartList_hover"),r.removeClass("cartButton_hover"),e.css("height","")})},50)}))},a.refreshData=function(s){var o=this;t.ajax({type:"post",url:"ajax/order_h.jsp?cmd=getTopBarMallCartList",data:"",success:function(s){var r=t.parseJSON(s),n=r.topBarProductList;r.success&&n.length>0?o.refrestCartList(r.topBarProductList,r.orderId,r.choiceCurrencyVal):(o.cartList.html(function(){if(e(),a.noGoodsHtmlStr==i){var t=[];t.push("<div class='cartSpacer'></div>"),t.push("<div class='shoppingList'>"),t.push("<div class='cartNoGoods'>"),t.push("<b></b>"),t.push("<div class='noGoodsText'>"),t.push("<p>"+LS.memberMallCartNoProduct+"</p>"),t.push("</div>"),t.push("</div>"),t.push("</div>"),a.noGoodsHtmlStr=t.join("")}return a.noGoodsHtmlStr}()),o.cartList.removeClass("dropCartList_goods"),Fai.top.$(".shoppingAmount").css("display","none"),Fai.top.$(".shoppingAmountContent").css("display","none"),Fai.top.$("#mallCart_js").find(".mallCart_proNum").text("(0)"),Fai.top.$("#J_WebRightBar").find(".fk-rbar-cartItem-cirNum").text("0"))}})},a.refrestCartList=function(s,i,a){e();var c,d,l=s.length,h=Fai.top.$(".shoppingAmount"),u=0,f=0,C=0,m=0;o=function(t){if((Fai.isIE6()||Fai.isIE7()||Fai.isIE8())&&n(t))return p(t);return t}(this.colorCode);var g=[],v=[];for(g.push("<div class='cartContent'>"),g.push("<div class='sCart-title'>"),g.push("<h4>"+LS.memberMallCartJoin+"</h4>"),g.push("</div>"),g.push("<div class='sC-Content'>"),g.push("<ul class='sC-sigleList'>"),d=0;d<l;d++){u+=L=(F=s[d]).amount}for(c=0;c<l;c++){var L=(F=s[c]).amount;F.isValid&&(C+=F.price*L)}for(c=0;c<l;c++){var F;L=(F=s[c]).amount;if(F.isValid?g.push(r(F,i,a)):v.push(r(F,i,a)),(m+=1)>=5)break}g.push(v.join("")),u>0&&(u>99?Fai.top.$("#J_WebRightBar").find(".fk-rbar-cartItem-cirNum").text("..."):Fai.top.$("#J_WebRightBar").find(".fk-rbar-cartItem-cirNum").text(u),f=u,u=u>99?"99+":u,h.text(u),Fai.top.$("#mallCart_js").find(".mallCart_proNum").text("("+u+")"),this.cartList.addClass("dropCartList_goods"),h.css("display","block"),Fai.top.$(".shoppingAmountContent").css("display","block")),g.push("</ul>"),g.push("</div>"),g.push("</div>"),g.push("<div class='cartCalculate'>"),g.push(Fai.format(LS.shoppingCartCalculatePro,f)),g.push("<span class='sC-priceTotal'>"+LS.shoppingCartCountMoney+"<b style='color:"+o+";'>"+a.toString()+C.toFixed(2)+"</b></span>"),g.push("</div>"),g.push("<div class='cartPayFor'>"),g.push("<a href='javascript:;' class='sC-payFor' style='background-color:"+o+";'>"+LS.memberMallCartCheckBtn+"</a>"),g.push("</div>"),this.cartList.find(".shoppingList").html(g.join("")),function(s,i){var a=s,o=(s.module,s.cartList.find(".sC-delItem"));o.each(function(){var s=t(this);s.off("click.sC").on("click.sC",function(){a.delShoppingCartItem(i,s.attr("tmpproductid"),o.index(s))})}),s.cartList.find(".cartPayFor a").off("click.sC").on("click.sC",function(){window.open("mcart.jsp","_blank")})}(this,i)},a.delShoppingCartItem=function(s,i,a){var o=this;t.ajax({type:"post",url:"ajax/order_h.jsp?cmd=delItem",data:{orderId:s,itemId:i,isTopBarMallCart:!0},error:function(s){t.parseJSON(s).success||Fai.ing("系统繁忙，请稍后重试。",!0)},success:function(s){var i=t.parseJSON(s);i.success?o.cartList.find(".sCart-sigle").length>1?(o.cartList.find(".sCart-sigle").length>4?o.cartList.find(".sC-Content").css("height","295px"):o.cartList.find(".sC-Content").css("height",""),o.cartList.find(".sCart-sigle").eq(a).stop(!0,!0).animate({height:"0"},400,function(){o.refreshData()})):o.refreshData():-2==i.rt&&Fai.ing("参数错误，请稍后重试。",!0)}})}}(jQuery),Site.initShoppingCart=function(t){Fai.top.shoppingCart=Fai.top.shoppingCart||{},Fai.top.shoppingCart["cart"+t]=new Site.ShoppingCart(t),Fai.top.shoppingCart["cart"+t].init()};