!function(e,t,a){a.commData=a.commData||{},a.commFun=a.commFun||{};var i=a.commData,o=a.commFun;i.subNavPackModule={historyModules:[]};a.packPanelDef={module:[{tab:{tabText:"设置模块",compon:"packModuleAddCompon",isActive:!0}},{tab:{tabText:"历史模块",compon:"historyModuleCompon",isActive:!1}}]},o.bindContentScrollBar=function(e,a){setTimeout(function(){t.top.$(e).mCustomScrollbar({mouseWheel:!0,theme:"fk-gray",scrollbarPosition:"outside",advanced:{updateOnContentResize:!0},axis:"y"}),"function"==typeof a&&a()},400)},o.bgColorPickerClick=function(t){if(!(t.base.length<1)){t.advance=!0,t.showInTop=!1,t.appendToWeb=!0;var a=t.onchange;t.inputHexStatus=function(e,t){a.call(null,t||e)},t.onchange=function(e,t){a.call(null,t||e)},e(this.$el).faiColorPickerAlp(t)}};var n=a.packPanelDef;Vue.component("fk-packpanel",{props:["curpanel","panelleft"],data:function(){return{packPanelDef:n,switchOn:!1,animateSart:!1,packOuterPanelStyle:{}}},computed:{curPanel:function(){return this.packPanelDef.module},curTab:function(){for(var e=this.curPanel,t=0,a=e.length;t<a;t++)if(e[t].tab.isActive)return e[t].tab;return e[0].tab},curTabIndex:function(){for(var e=this.curPanel,t=this.curTab,a=0,i=e.length;a<i;a++)if(e[a].tab.compon==t.compon)return a;return 0},triangleActiveStyle:function(){return{left:83*this.curTabIndex+41.5-7+"px"}}},watch:{curTabIndex:function(e,t){this.animateSart=t<e}},template:"<div class='packOuterPanel' @click='packPanelClick' :style='{left:panelleft + \"px\"}'><div class='packMainNav'><div class='curMainSetingNav'><div class='mainSettingTab' v-for='(item, index) in curPanel' @click='tabClick(item.tab, index)'>{{item.tab.tabText}}</div><div class='triangleActive' :style='triangleActiveStyle'></div></div><div class='closeFunPanel' @click='closeFunPanel'></div></div><div class='packSettingContent' :class='{outPanelAnimateStart:animateSart}'><transition name='translate-fade' mode='out-in'><keep-alive><component :is='curTab.compon' packpaneldef='packPanelDef'></component></keep-alive></transition></div></div>",methods:{tabClick:function(e,t){this.curTab.isActive=!1,e.isActive=!0,this.curTab=e},packPanelClick:function(){this.switchOn=!1},closeFunPanel:function(){Site.logDog(200256,16),a["packPanel"+Site.inSubNavPackEdit.colId].panelOpen=!1,Site.inSubNavPackEdit.exitSubNavPackEdit()}},mounted:function(){Site.inSubNavPackEdit.colIdActivedArr=Site.inSubNavPackEdit.colIdActivedArr||[],e.inArray(Site.inSubNavPackEdit.colId,Site.inSubNavPackEdit.colIdActivedArr)<0&&Site.inSubNavPackEdit.colIdActivedArr.push(Site.inSubNavPackEdit.colId),e(".packOuterPanel").draggable("destroy").draggable({containment:"body",distance:3,cursor:"move",axis:"x,y",scroll:!1,start:function(){t.top.$("#funPanelOverLay").show(),t.top.$("#colorpanel").remove(),t.top.$(".faiColorPicker").remove()},stop:function(){t.top.$("#funPanelOverLay").hide(),e(this).offset().left;var a=e(this).offset().top,i=t.top.$("#g_main").offset().top;a<i&&(a=i,e(this).offset({top:i}))}}).delegate("input,textarea,.colModuleNameText","click.input",function(e){e.stopPropagation()}).off("click.funPanel").on("click.funPanel",function(){var t=e(this).find(":focus");t.length<1||t.hasClass("colModuleName")||e(this).find(":focus").blur()}),e(".funOuterPanel").resizable("destroy").resizable({handles:"e,w",minWidth:350,maxWidth:640,create:function(t,a){e(this).find(".ui-resizable-handle").addClass("funPanelResizeHandle")}})}}),a.commData.addModuleList=[];var l=!1;function s(e){var a,i=t.top.Site.inSubNavPackEdit.colId;a=t.top.Site.buildNavV2BgStyle(e),t.top.$("#fk-subNavPack"+i).css({background:a}),Site.showRepeatTip(e.pp),Site.styleChanged()}o.refreshAddModuleList=function(){l&&(i.addModuleList=d())},Vue.component("packModuleAddCompon",{data:function(){l=!0,i.addModuleList=d();var e,a=Site.inSubNavPackEdit.subNavPackObj["col"+Site.inSubNavPackEdit.colId],o=a.bgData;return a.bgc&&void 0===o.t&&(o.t=2,o.c=a.bgc),o.t=o.t||0,e={imgPath:o.ph,imgId:o.pi,picScale:o.ps,repeat:o.pp,color:o.c?o.c:"#fff",bgRepeatLists:[{value:0,label:"平铺",type:"Tiling",hidden:!1},{value:1,label:"不平铺",type:"not-tile",hidden:!1},{value:2,label:"拉伸",type:"stretch",hidden:!1}],uploadData:{title:"添加图片",maxSize:t.top._internal?3:1,type:["jpg","jpeg","gif","png","bmp"],from:"bg",entry:"webBg"},showEffect:!1},{commData:i,setStyleData:a,bgData:o,bgOpts:e}},computed:{totalModules:function(){return this.commData.addModuleList},setBgUseShortHeight:function(){return 0==this.bgOpts.type||!this.bgData.ph}},activated:function(){i.addModuleList=d()},template:"<div class='panelInnerContent panelInnerContent_addModule'><div class='moduleFieldset' v-for='fieldset in totalModules' ><div class='legend'><span class='legendText'>{{fieldset.groupName}}</span></div><transition name='component-addmodule' mode='out-in'><div class='moduleViewList'><div class='moduleAloneArea' :class='\"moduleArea_\" + module.keyword' @click='addModuleClick(module.keyword)' v-for='module in fieldset.list'><div class='moduleAloneIcon'></div><div class='moduleAloneText'>{{module.name}}</div></div></div></transition></div><div class='setStyle'><div class='legend'><span class='legendText'>设置样式</span></div><div class='item'><div class='itemTit'>通栏：</div><switch-component ref='fullMeasureType' style='margin-left:16px' v-model='setStyleData.ifm' v-undo.switchBtn @on-change='fullMeasureChange'></switch-component></div><div :class='{ \"f-item-bg-short-height\" : setBgUseShortHeight }' class='f-item-bg item'><span class='itemTit' slot='title'>背景：</span><span slot='radioswitch'><radio-group-component ref='bgDataType' class='fk-bg-radio-wrap' v-model='bgData.t' v-undo:t.radio='bgData' @on-change='bgTypeChange'><radio-component :label='0' >默认</radio-component><radio-component :label='2' >自定义</radio-component></radio-group-component></span><background-component slot='itemsetting' ref='panelBg' :data='bgOpts'  v-show='bgData.t==2' v-undo.bg @img-change='bgImgChange' @bg-scale-change='bgScaleChange' @bg-repeat-change='bgTilingChange' @bg-effect-change='bgEffectChange'@bg-color-change='bgColorChange'></background-component></div></div></div>",methods:{fullMeasureChange:function(a){this.setStyleData.ifm=!!a;var i,o,n,l,s,d,c,u=Site.inSubNavPackEdit,r=u.colId,p=e("#fk-subNavPack"+r),f=e("#fk-subNavPack"+r).find(".container"),m=e("#fk-subNavPack"+r).find(".editSubNavPack"),h=t.top.$("#nav"+r),v=t.top.$("#webContainer"),g=t.top.$("#web").width();v.length<1||(n=v.width(),l=v.offset().left,a?(u.subNavPackBindResizable(p,"s"),u.subNavPackObj["col"+r].ifm=!0,d="100%",document.getElementById("g_main").scrollHeight>document.getElementById("g_main").clientHeight&&(d=e("#web").width()+"px"),p.css({width:""+d,left:""}),f.css("margin-left",l+"px"),f.width(n),m.css("left",l+10+"px")):(i=n,o=p.data("packSizeData"),s=n+l,u.subNavPackBindResizable(p,"s,w,e"),u.subNavPackObj["col"+r].ifm=!1,1==o.lt?(subPackLeft=o.nl+h.offset().left,subPackLeft=subPackLeft<0?0:subPackLeft,p.css("left",Math.floor(subPackLeft)+"px"),l>subPackLeft?f.css("margin-left",l-subPackLeft+"px"):f.css("margin-left",0),subPackLeft+o.w>g?p.width(g-subPackLeft):p.width(o.w),c=o.w+subPackLeft,minRight=Math.min(c,s),maxLeft=Math.max(l,subPackLeft),i=minRight-maxLeft,f.width(i)):(p.css("left",l+"px"),f.css("margin-left",0),i=n,p.width(i),f.width(i),o.lt=0,p.data("packSizeData",o)),m.css("left","")),Site.logDog(200256,12),Site.styleChanged())},addModuleClick:function(a){!function(a){t.top._subNavPackEdit&&(t.top._appendArea="fk-subNavPack"+Site.inSubNavPackEdit.colId+" .container");var i=t.top._colId,o=t.top._extId,n=(t.top._funPanelOption&&t.top._funPanelOption.sysIndex,t.top._funPanelOption&&t.top._funPanelOption.schemeCust,[]);if("floatImg"==a)Site.logDog(200256,9),t.ing("正在保存……",!1),e.ajax({type:"post",url:"ajax/module_h.jsp?cmd=add&subNavPackModule=true&style=79&colId="+i+"&extId="+o,data:"name="+t.encodeUrl("图片"),error:function(){t.ing("服务繁忙，请稍候重试",!1)},success:function(a){var i=e.parseJSON(a);t.successHandle(a,"","系统错误","",3,1)&&(Site.addNewModule(i.id,i.div,null,null,{returnModuledata:i.moduleData}),n.push(i.id),Site.inSubNavPackEdit.addModuleSave(n,Site.inSubNavPackEdit.colId))}});else if("simpleText"==a)Site.logDog(200256,8),t.ing("正在保存……",!1),e.ajax({type:"post",url:"ajax/module_h.jsp?cmd=add&subNavPackModule=true&style=86&colId="+i+"&extId="+o,data:"name="+t.encodeUrl("文本"),error:function(){t.ing("服务繁忙，请稍候重试",!1)},success:function(a){var i=e.parseJSON(a);t.successHandle(a,"","系统错误","",3,1)&&(Site.addNewModule(i.id,i.div,null,null,{returnModuledata:i.moduleData}),e("#module"+i.id).length>0&&(e("#module"+i.id).data("breakWord",!0).find(".fk-editor").addClass("fk-editor-break-word"),e("#module"+i.id).data("fixTextTrim",!0)),n.push(i.id),Site.inSubNavPackEdit.addModuleSave(n,Site.inSubNavPackEdit.colId))}});else if("floatBtn"==a){var l=function(e,t){return"rgba("+parseInt("0x"+e.slice(1,3))+","+parseInt("0x"+e.slice(3,5))+","+parseInt("0x"+e.slice(5,7))+","+t+")"},s=function(e,t){-1!==e.indexOf("#")&&(e=l(e,1));var a=e.split(","),i=[];i.push(a[0].substr(5)),i.push(a[1].substr(0)),i.push(a[2].substr(0)),i.push(a[3].substr(0,a[3].length-1));for(var o=0;o<3;o++)i[o]=Math.floor((255-parseInt(i[o]))*t+parseInt(i[o]));return"rgba("+i[0]+","+i[1]+","+i[2]+","+i[3]+")"};Site.logDog(200256,10);var d,c="ajax/module_h.jsp?cmd=add&subNavPackModule=true&style=81&colId="+i+"&extId="+o+"&flag1=true",u=[],r={};if(u.push("&prop1="+t.encodeUrl(e.toJSON({bns:101,bs:{v:"按钮",hn:"",h:"",hi:""}}))),t.top._isTemplateVersion2){var p=t.top._majorColorData,f=l(p,1);f=s(f,.5),d={imc:0,cc:p,utc:1,gcc:f}}else{u.push("&prop2=0");var m=l("#b7031c",1);m=s(m,.5),d={imc:0,cc:"#b7031c",utc:0,gcc:m}}u.push("&prop3="+t.encodeUrl(e.toJSON(d))),u.push("&prop4=0"),r.w=163,r.h=52,r.cb={},r.cb.y=1,r.e=1,r.d={},r.d.y=1,r.i={},r.i.t=0,r.i.b=0,r.i.l=0,r.i.r=0,r.i.y=0,r.cl={},r.cl.y=1,r.cl.ls=12,r.cl.f="微软雅黑",r.vfb={},u.push("&pattern="+t.encodeUrl(e.toJSON(r))),u.push("&name="+t.encodeUrl("按钮")),t.ing("正在保存……",!1),e.ajax({type:"post",url:c,data:u.join(""),error:function(){t.ing("服务繁忙，请稍候重试",!1)},success:function(a){var i=e.parseJSON(a);t.successHandle(a,"","系统错误","",3,1)&&(0==top.$("link[href='"+i.styleLink+"']").length&&top.$('<link type="text/css" href="'+i.styleLink+'" rel="stylesheet">').appendTo(top.$("head")),Site.addNewModule(i.id,i.div,null,null,{returnModuledata:i.moduleData}),e("#module"+i.id).css({width:"162px",height:"52px"}),n.push(i.id),Site.inSubNavPackEdit.addModuleSave(n,Site.inSubNavPackEdit.colId))}})}Site.setRefreshInfo("moduleEdit",!0)}(a)},bgScaleChange:function(e){this.bgData.ps=e,0==e?this.bgData.pp=3:1==e&&(this.bgData.pp=0),this.bgOpts.picPos=this.bgData.pp,s(this.bgData)},bgTilingChange:function(e){this.bgData.pp=e,s(this.bgData)},bgEffectChange:function(e){},bgTypeChange:function(e){this.bgData.t=e,s(this.bgData),2==e&&Site.logDog(200256,22)},bgColorChange:function(e,a){var i,o,n,l,d=this;i=e,o=d.bgData,n=t.top.Site.inSubNavPackEdit.colId,l=t.top.$("#fk-subNavPack"+n),o.c=i,d.bgOpts.color=i,"transparent"==i||/rgba\((\d{1,3},\s*){1,3}0\)/.test(i)?l.addClass("fk-subNavPack-no-shadow"):l.removeClass("fk-subNavPack-no-shadow"),s(o)},bgImgChange:function(t){if(t){var a=e.parseJSON(t).data[0]||{};this.bgData.ph=a.filePath,this.bgData.pi=a.fileId,this.bgOpts.imgPath=a.filePath,this.bgOpts.imgId=a.fileId,-1!=this.bgData.pp&&void 0!==this.bgData.pp||(this.bgData.ps=0,this.bgData.pp=3,this.bgOpts.picScale=0,this.bgOpts.picPos=3),s(this.bgData)}}},mounted:function(){!function(){var a=t.top.$("#fk-packPanel .panelInnerContent_addModule").find(".moduleAloneArea"),i=(a.filter(".moduleArea_fullmeasure"),".J_moduleZone:visible, .column:visible, .fullmeasureContent:visible, .J_packContent:visible, .formTabButtonList:visible, .formTabButtonYList:visible");t.top._subNavPackEdit&&(i=".J_subNavPack:visible");a.draggable("destroy").draggable({helper:function(){return"<div id='panelInnerContentDrag' class='panelInnerContent panelInnerContentDrag'><div class='"+e(this).attr("class")+" moduleAloneAreaDrag'><div class='moduleAloneIcon'></div><div class='moduleAloneText'>"+e(this).find(".moduleAloneText").text()+"</div></div></div>"},appendTo:"#g_main",cursor:"move",zIndex:9999,opacity:.6,connectToSortable:i,start:function(e,a){t.top.dragToAddModule=!0},stop:function(a,i){e(this).children().eq(0).trigger("click"),Site.sortableHelper.replaceAddModuleBtn(i),t.top._subNavPackEdit&&t.top.$(".J_subNavPack").find("div.moduleAloneArea").remove(),t.top.dragToAddModule=!1}})}(),this.$nextTick(function(){a.commFun.bindContentScrollBar(".panelInnerContent_addModule")})}});var d=function(){var e=[],t=[];return e.push({name:"文本",keyword:"simpleText",show:!0}),e.push({name:"图片",keyword:"floatImg",show:!0}),e.push({name:"按钮",keyword:"floatBtn",show:!0}),t.push({groupName:"添加模块",list:e}),t};Site.goToPackPanel=function(e,t){if(a&&a.packPanelDef&&a.packPanelDef.module){for(var i=0;i<a.packPanelDef.module.length;i++)a.packPanelDef.module[i].tab.isActive=!1;a.packPanelDef.module[e].tab.isActive=!0,"function"==typeof t&&Vue.nextTick(function(){t()})}},Site.bindGobalEvent("site_subNavPack_hideModule",function(a,i){i.show&&Site.goToPackPanel(1,function(){setTimeout(function(){!function(a){if(a.show&&(t.top.$("#fk-packPanelArea"+t.top.Site.inSubNavPackEdit.colId).find(".moduleId"+a.id).find(".historyModuleViewSwitch").click(),t.top.$(".packOuterPanel").attr("panelopen"))){var i=e("<div></div>");t.top.$("body").append(i),i.css({border:"2px solid #ff4400",position:"absolute",zIndex:"9999",top:a.top,left:a.left,height:a.height+"px",width:a.width+"px"});var o=e("#fk-packPanelArea"+t.top.Site.inSubNavPackEdit.colId),n=o.find(".historyModuleContainer"),l=0;n.mCustomScrollbar("scrollTo",".moduleId"+a.id,{scrollInertia:300}),n.find(".mCSB_scrollTools_vertical").is(":visible")&&(l=400),setTimeout(function(){Vue.nextTick(function(){var e=o.find(".moduleId"+a.id);e.length<1&&(e=o.find(".historyModuleListWrap").first()),i.animate({top:e.offset().top+"px",left:e.offset().left+"px",width:e.outerWidth()+"px",height:e.outerHeight()+"px"},850,function(){i.remove()})})},l)}}(i)},300)})});var c=i.subNavPackModule;function u(a){e.ajax({type:"post",url:Site.genAjaxUrl("col_h.jsp"),data:"cmd=getColSubNavPackModule&id="+top.Site.inSubNavPackEdit.colId,async:!1,error:function(){t.ing("系统繁忙，请稍候重试",!1)},success:function(i){var o=e.parseJSON(i);!function(e){for(var a,i=t.top.$("#fk-subNavPack"+top.Site.inSubNavPackEdit.colId),o=0;o<e.length;o++)e[o].orName=e[o].name,a=i.find("#module"+e[o].id),e[o].s=!!a.is(":visible")}(o),function(e){e.map(function(e,a){var i,o=e.id,n=t.top.$("#module"+o);return"文本"==e.name?n.length>0&&n.find(".fkEditor-wrap .editTip").length<1&&(e.name=n.text().trim()):"图片"==e.name?(i=n.find("#float_img_"+o)).length>0&&(e.name=i.attr("alt")||"图片"):"按钮"==e.name&&(i=n.find("#module"+o+"FlBtn")).length>0&&(e.name=i.text().trim()),e})}(o=r(o)),a.historyModules=o}})}function r(e){for(var t=[],a=[],i=0;i<e.length;i++)e[i].s?t.push(e[i]):a.push(e[i]);return e=t.concat(a)}o.refreshHisModuleListData=function(){u(c)},o.setHisModuleListData=function(){historyModuleList=[]},Vue.component("historyModuleCompon",{data:function(){return{subNavPackModule:c}},beforeCreate:function(){u(c)},template:"<div class='historyModuleContainer'><div class='historyModuleListWrap'><ul class='historyModuleStaUl topModuleList'><li is='moduleLiCompon' class='topModuleLi' v-for='model in subNavPackModule.historyModules' :model='model' :modellist='subNavPackModule.historyModules'></li></ul></div></div>"}),Vue.component("moduleLiCompon",{props:["model","modellist"],data:function(){return{editName:!1}},template:"<div class='historyModuleStatcLine' :class='[\"moduleId\" + model.id, \"moduleStyle\" + model.style]' title='双击修改模块名称' @dblclick.stop='toggleEdit($event)'><span class='historyModuleLineLeft' @click='showThisModule(model)'><span class='historyModuleNameText' :class='{showModuleNameText:model.s}' v-if='!editName'>{{model.name? model.name: '&nbsp;'}}</span><input maxlength='50' class='historyModuleName' v-if='editName' v-model='model.name' @blur='editNameBlur'/></span><span class='historyModuleLineRight'><div class='historyModuleViewSwitch' :class='{historyModuleViewBlock:model.s}' :title='model.iconTitle' @click='moduleViewSwitchSwitch'></div><div class='historyModuleDel' title='删除模块' @click='delModelClick'></div></span></div>",methods:{toggleEdit:function(t){this.editName=!this.editName,this.editName&&Vue.nextTick(function(){e(".historyModuleName").focus()})},editNameBlur:function(){var a,i,o,n;this.editName=!1,a=this.model,i=a.id,a.style,o=a.name,n=a.orName,""!=e.trim(o)&&o!=n?o!=n&&e.ajax({type:"post",url:Site.genAjaxUrl("module_h.jsp"),data:"cmd=setBack&id="+i+"&name="+t.encodeUrl(o)+"&colId="+t.top._colId,error:function(){t.ing("系统繁忙，请稍候重试",!1)},success:function(t){var a=e.parseJSON(t);a.success&&Site.refreshModule(a.id,a.div,o)}}):a.title=n},moduleViewSwitchSwitch:function(){Site.styleChanged(),this.model.s=!this.model.s,historyModuleList=r(this.modellist);for(var e=0;e<historyModuleList.length;e++)this.modellist.splice(e,1,historyModuleList[e]);this.model.s?t.top.$("#module"+this.model.id).show():t.top.$("#module"+this.model.id).hide()},delModelClick:function(){if(Site.styleChanged(),function(a){var i=!1;return e.ajax({type:"post",url:Site.genAjaxUrl("module_h.jsp"),data:"cmd=del&id="+a,async:!1,error:function(){t.ing("系统繁忙，请稍候重试",!1)},success:function(o){e.parseJSON(o).success&&(t.top.$("#module"+a).remove(),i=!0)}}),i}(this.model.id))for(var a=0;a<this.modellist.length;a++)if(this.modellist[a].id==this.model.id)return void this.modellist.splice(a,1)},showThisModule:function(e){e&&Site.triggerGobalEvent("showFindModuleDiv",e.id)}},mounted:function(){e("#fk-packPanelArea .historyModuleLineLeft, .historyModuleStatcList").focusin(function(e){e.stopPropagation()}),a.commFun.bindContentScrollBar(".historyModuleContainer")}})}($,Fai,Fai.top.v_packPanel||(v_packPanel={}));